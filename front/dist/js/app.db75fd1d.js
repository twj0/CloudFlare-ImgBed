(function(){"use strict";var e={5544:function(e,t,n){var r=n(5130),o=n(6768),a=n(782);const i={id:"app"};var s={__name:"App",setup(e){(0,a.Pj)();(0,o.sV)(()=>{console.log("macOS Finder Style Image Bed initialized"),t()});const t=()=>{const e=document.createElement("link");e.rel="icon",e.href="/logo.png",document.head.appendChild(e)};return(e,t)=>{const n=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.bF)(n)])}}};const d=s;var c=d,l=n(1387),u=n(1219),m=(n(4114),n(4373)),f=n(4570),p=n.n(f);const h="https://imgbed.ttwwjj.ddns-ip.net/api",g=m.A.create({baseURL:h,timeout:1e4,withCredentials:!0});g.interceptors.request.use(e=>{if(e.withAuthCode){const t=p().get("authCode");t&&(e.headers["authCode"]=t)}return e},e=>Promise.reject(e)),g.interceptors.response.use(e=>e,e=>(e.config?.withAuthCode&&401===e.response?.status&&(u.nk.error("认证失败，请重新登录！"),A.push("/login")),Promise.reject(e)));var E=g,y=n(5131);n(8111),n(2489),n(116),n(1701);const v={currentPath:"/",navigationHistory:["/"],currentHistoryIndex:0,viewMode:"grid",sortField:"name",sortOrder:"asc",searchQuery:"",items:[],selectedItems:[],loading:!1,error:null,favorites:[{name:"图片",path:"/images",type:"folder"},{name:"最近上传",path:"/recent",type:"folder"}],recentItems:[],uploadProgress:{visible:!1,files:[],totalProgress:0},sidebarVisible:!0,sidebarWidth:200,zoomLevel:1},T={SET_CURRENT_PATH(e,t){e.currentPath=t},SET_NAVIGATION_HISTORY(e,{history:t,index:n}){e.navigationHistory=t,e.currentHistoryIndex=n},ADD_TO_HISTORY(e,t){e.currentHistoryIndex<e.navigationHistory.length-1&&(e.navigationHistory=e.navigationHistory.slice(0,e.currentHistoryIndex+1)),e.navigationHistory[e.navigationHistory.length-1]!==t&&(e.navigationHistory.push(t),e.currentHistoryIndex=e.navigationHistory.length-1)},SET_VIEW_MODE(e,t){e.viewMode=t},SET_SORT_FIELD(e,t){e.sortField=t},SET_SORT_ORDER(e,t){e.sortOrder=t},SET_SEARCH_QUERY(e,t){e.searchQuery=t},SET_ITEMS(e,t){e.items=t},SET_SELECTED_ITEMS(e,t){e.selectedItems=t},SET_LOADING(e,t){e.loading=t},SET_ERROR(e,t){e.error=t},ADD_FAVORITE(e,t){e.favorites.find(e=>e.path===t.path)||e.favorites.push(t)},REMOVE_FAVORITE(e,t){const n=e.favorites.findIndex(e=>e.path===t);n>-1&&e.favorites.splice(n,1)},ADD_RECENT_ITEM(e,t){const n=e.recentItems.findIndex(e=>e.path===t.path);n>-1&&e.recentItems.splice(n,1),e.recentItems.unshift({...t,lastAccessed:Date.now()}),e.recentItems.length>20&&(e.recentItems=e.recentItems.slice(0,20))},SET_UPLOAD_PROGRESS(e,t){e.uploadProgress={...e.uploadProgress,...t}},SET_SIDEBAR_VISIBLE(e,t){e.sidebarVisible=t},SET_SIDEBAR_WIDTH(e,t){e.sidebarWidth=t},SET_ZOOM_LEVEL(e,t){e.zoomLevel=Math.max(.5,Math.min(3,t))}},S={async initialize({commit:e,dispatch:t},n="/"){e("SET_CURRENT_PATH",n),e("ADD_TO_HISTORY",n),await t("loadItems",n)},async navigateTo({commit:e,dispatch:t,state:n},r){r!==n.currentPath&&(e("SET_CURRENT_PATH",r),e("ADD_TO_HISTORY",r),e("SET_SELECTED_ITEMS",[]),await t("loadItems",r))},async navigateBack({commit:e,dispatch:t,state:n}){if(n.currentHistoryIndex>0){const r=n.currentHistoryIndex-1,o=n.navigationHistory[r];e("SET_CURRENT_PATH",o),e("SET_NAVIGATION_HISTORY",{history:n.navigationHistory,index:r}),await t("loadItems",o)}},async navigateForward({commit:e,dispatch:t,state:n}){if(n.currentHistoryIndex<n.navigationHistory.length-1){const r=n.currentHistoryIndex+1,o=n.navigationHistory[r];e("SET_CURRENT_PATH",o),e("SET_NAVIGATION_HISTORY",{history:n.navigationHistory,index:r}),await t("loadItems",o)}},async refreshCurrentPath({dispatch:e,state:t}){await e("loadItems",t.currentPath)},async loadItems({commit:e},t){e("SET_LOADING",!0),e("SET_ERROR",null);try{const n=await b.getItems(t);e("SET_ITEMS",n)}catch(n){console.error("Failed to load items:",n),e("SET_ERROR",n.message),e("SET_ITEMS",[])}finally{e("SET_LOADING",!1)}},async uploadFiles({commit:e,dispatch:t},{files:n,path:r}){e("SET_UPLOAD_PROGRESS",{visible:!0,files:n.map(e=>({name:e.name,progress:0,status:"pending"})),totalProgress:0});try{for(let t=0;t<n.length;t++){n[t];e("SET_UPLOAD_PROGRESS",{files:n.map((e,n)=>({name:e.name,progress:n<t?100:0,status:n<t?"completed":n===t?"uploading":"pending"}))});for(let r=0;r<=100;r+=10)await new Promise(e=>setTimeout(e,100)),e("SET_UPLOAD_PROGRESS",{files:n.map((e,n)=>({name:e.name,progress:n<t?100:n===t?r:0,status:n<t?"completed":n===t?"uploading":"pending"})),totalProgress:(100*t+r)/(100*n.length)*100});e("SET_UPLOAD_PROGRESS",{files:n.map((e,n)=>({name:e.name,progress:n<=t?100:0,status:n<=t?"completed":"pending"}))})}await t("refreshCurrentPath"),setTimeout(()=>{e("SET_UPLOAD_PROGRESS",{visible:!1})},2e3)}catch(o){throw console.error("Upload failed:",o),e("SET_UPLOAD_PROGRESS",{visible:!1}),o}},toggleFavorite({commit:e,state:t},n){const r=t.favorites.find(e=>e.path===n.path);r?e("REMOVE_FAVORITE",n.path):e("ADD_FAVORITE",{name:n.name,path:n.path,type:n.type})},addToRecent({commit:e},t){e("ADD_RECENT_ITEM",t)}},_={currentPath:e=>e.currentPath,viewMode:e=>e.viewMode,sortField:e=>e.sortField,sortOrder:e=>e.sortOrder,searchQuery:e=>e.searchQuery,items:e=>e.items,selectedItems:e=>e.selectedItems,loading:e=>e.loading,error:e=>e.error,favorites:e=>e.favorites,recentItems:e=>e.recentItems,uploadProgress:e=>e.uploadProgress,sidebarVisible:e=>e.sidebarVisible,sidebarWidth:e=>e.sidebarWidth,zoomLevel:e=>e.zoomLevel,canGoBack:e=>e.currentHistoryIndex>0,canGoForward:e=>e.currentHistoryIndex<e.navigationHistory.length-1,filteredItems:e=>{let t=[...e.items];if(e.searchQuery){const n=e.searchQuery.toLowerCase();t=t.filter(e=>e.name.toLowerCase().includes(n))}return t.sort((t,n)=>{let r,o;switch(e.sortField){case"name":r=t.name.toLowerCase(),o=n.name.toLowerCase();break;case"size":r=t.size||0,o=n.size||0;break;case"type":r=t.type,o=n.type;break;case"modified":r=new Date(t.modified||0),o=new Date(n.modified||0);break;default:return 0}return r<o?"asc"===e.sortOrder?-1:1:r>o?"asc"===e.sortOrder?1:-1:0}),t.sort((e,t)=>"folder"===e.type&&"folder"!==t.type?-1:"folder"!==e.type&&"folder"===t.type?1:0)}},b={async getItems(e){await new Promise(e=>setTimeout(e,300));const t={"/":[{name:"我的图片",path:"/images",type:"folder",size:0,modified:Date.now()-864e5,created:Date.now()-6048e5},{name:"最近上传",path:"/recent",type:"folder",size:0,modified:Date.now()-36e5,created:Date.now()-2592e5}],"/images":[{name:"photo1.jpg",path:"/images/photo1.jpg",type:"image",size:2048576,modified:Date.now()-36e5,created:Date.now()-36e5,url:"/static/404.png",thumbnail:"/static/404.png",width:1920,height:1080},{name:"photo2.png",path:"/images/photo2.png",type:"image",size:1536e3,modified:Date.now()-72e5,created:Date.now()-72e5,url:"/static/404.png",thumbnail:"/static/404.png",width:1280,height:720}],"/recent":[]};return t[e]||[]}};var I={namespaced:!0,state:v,mutations:T,actions:S,getters:_},O=(0,a.y$)({state:{userConfig:null,credentials:null,useDarkMode:null,cusDarkMode:!1,uploadMethod:"default",uploadFolder:""},getters:{userConfig:e=>e.userConfig,credentials:e=>e.credentials,useDarkMode:e=>e.useDarkMode,cusDarkMode:e=>e.cusDarkMode,storeUploadMethod:e=>e.uploadMethod,storeUploadFolder:e=>e.uploadFolder||localStorage.getItem("uploadFolder")||""},mutations:{setUserConfig(e,t){e.userConfig=t},setCredentials(e,t){e.credentials=t},setUseDarkMode(e,t){e.useDarkMode=t},setCusDarkMode(e,t){e.cusDarkMode=t},setUploadMethod(e,t){e.uploadMethod=t},setStoreUploadFolder(e,t){e.uploadFolder=t,localStorage.setItem("uploadFolder",t)}},actions:{async fetchUserConfig({commit:e}){try{const t=await E.get("/api/userConfig");e("setUserConfig",t.data)}catch(t){console.log("Failed to fetch user config:",t),e("setUserConfig",{siteTitle:"macOS Finder Style Image Bed",siteIcon:"/logo.png"})}}},modules:{finder:I},plugins:[(0,y.A)()]});const w=(e,t,n)=>{const r=O.getters.credentials;r&&"admin"===r.role?n():(u.nk.error("需要管理员权限"),n("/login"))},R=[{path:"/",redirect:"/finder"},{path:"/finder",name:"finder",component:()=>Promise.all([n.e(57),n.e(198)]).then(n.bind(n,8198))},{path:"/login",name:"login",component:()=>Promise.all([n.e(562),n.e(26)]).then(n.bind(n,6026))},{path:"/image-manager",name:"imageManager",component:()=>Promise.all([n.e(57),n.e(799)]).then(n.bind(n,3799)),beforeEnter:w},{path:"/:pathMatch(.*)*",name:"notFound",component:()=>Promise.all([n.e(562),n.e(367)]).then(n.bind(n,5367))}],D=(0,l.aE)({history:(0,l.LA)("/"),routes:R});var A=D,P=n(2474),C=(n(4188),n(1862),n(7477));const k=(0,r.Ef)(c);for(const[L,F]of Object.entries(C))k.component(L,F);const H=()=>{const e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=document.documentElement;e?t.classList.add("dark-theme"):t.classList.remove("dark-theme"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{e.matches?t.classList.add("dark-theme"):t.classList.remove("dark-theme")})},M=()=>{document.title="macOS Finder 风格图床";const e=document.createElement("link");e.rel="icon",e.href="/logo.png",document.head.appendChild(e)};H(),M(),k.use(O).use(A).use(P.A).mount("#app")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,r,o,a){if(!r){var i=1/0;for(l=0;l<e.length;l++){r=e[l][0],o=e[l][1],a=e[l][2];for(var s=!0,d=0;d<r.length;d++)(!1&a||i>=a)&&Object.keys(n.O).every(function(e){return n.O[e](r[d])})?r.splice(d--,1):(s=!1,a<i&&(i=a));if(s){e.splice(l--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[r,o,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce(function(t,r){return n.f[r](e,t),t},[]))}}(),function(){n.u=function(e){return"js/"+e+"."+{26:"7a00ed66",57:"a3f51696",198:"8f059b89",367:"7b217ee7",799:"024fcdc9"}[e]+".js"}}(),function(){n.miniCssF=function(e){return"css/"+e+"."+{26:"df6f5db8",57:"fbba3a81",198:"3e6b463f",367:"f3bebff3",562:"a3dae272",799:"8e06870e"}[e]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="sanyue_imghub:";n.l=function(r,o,a,i){if(e[r])e[r].push(o);else{var s,d;if(void 0!==a)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var u=c[l];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+a){s=u;break}}s||(d=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+a),s.src=r),e[r]=[o];var m=function(t,n){s.onerror=s.onload=null,clearTimeout(f);var o=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach(function(e){return e(n)}),t)return t(n)},f=setTimeout(m.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=m.bind(null,s.onerror),s.onload=m.bind(null,s.onload),d&&document.head.appendChild(s)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,r,o,a){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",n.nc&&(i.nonce=n.nc);var s=function(n){if(i.onerror=i.onload=null,"load"===n.type)o();else{var r=n&&n.type,s=n&&n.target&&n.target.href||t,d=new Error("Loading CSS chunk "+e+" failed.\n("+r+": "+s+")");d.name="ChunkLoadError",d.code="CSS_CHUNK_LOAD_FAILED",d.type=r,d.request=s,i.parentNode&&i.parentNode.removeChild(i),a(d)}};return i.onerror=i.onload=s,i.href=t,r?r.parentNode.insertBefore(i,r.nextSibling):document.head.appendChild(i),i},t=function(e,t){for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var o=n[r],a=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(a===e||a===t))return o}var i=document.getElementsByTagName("style");for(r=0;r<i.length;r++){o=i[r],a=o.getAttribute("data-href");if(a===e||a===t)return o}},r=function(r){return new Promise(function(o,a){var i=n.miniCssF(r),s=n.p+i;if(t(i,s))return o();e(r,s,null,o,a)})},o={524:0};n.f.miniCss=function(e,t){var n={26:1,57:1,198:1,367:1,562:1,799:1};o[e]?t.push(o[e]):0!==o[e]&&n[e]&&t.push(o[e]=r(e).then(function(){o[e]=0},function(t){throw delete o[e],t}))}}}(),function(){var e={524:0};n.f.j=function(t,r){var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)r.push(o[2]);else if(562!=t){var a=new Promise(function(n,r){o=e[t]=[n,r]});r.push(o[2]=a);var i=n.p+n.u(t),s=new Error,d=function(r){if(n.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var a=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",s.name="ChunkLoadError",s.type=a,s.request=i,o[1](s)}};n.l(i,d,"chunk-"+t,t)}else e[t]=0},n.O.j=function(t){return 0===e[t]};var t=function(t,r){var o,a,i=r[0],s=r[1],d=r[2],c=0;if(i.some(function(t){return 0!==e[t]})){for(o in s)n.o(s,o)&&(n.m[o]=s[o]);if(d)var l=d(n)}for(t&&t(r);c<i.length;c++)a=i[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(l)},r=self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=n.O(void 0,[504],function(){return n(5544)});r=n.O(r)})();
//# sourceMappingURL=app.db75fd1d.js.map