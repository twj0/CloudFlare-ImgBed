# ğŸ¤– CloudFlare ImgBed Telegramé›†æˆé…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

CloudFlare ImgBedä½¿ç”¨Telegramä½œä¸ºå›¾ç‰‡å­˜å‚¨åç«¯ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å®ŒæˆTelegramé›†æˆçš„å®Œæ•´é…ç½®ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### **æ­¥éª¤1: åˆ›å»ºTelegram Bot**

1. **è”ç³»BotFather**:
   - åœ¨Telegramä¸­æœç´¢ `@BotFather`
   - å‘é€ `/newbot` å‘½ä»¤
   - æŒ‰æç¤ºè®¾ç½®botåç§°å’Œç”¨æˆ·å

2. **è·å–Bot Token**:
   - BotFatherä¼šæä¾›ä¸€ä¸ªtokenï¼Œæ ¼å¼å¦‚ï¼š`123456789:ABCdefGHIjklMNOpqrsTUVwxyz`
   - **ä¿å­˜è¿™ä¸ªtokenï¼Œç¨åéœ€è¦ç”¨åˆ°**

3. **é…ç½®Botæƒé™**:
   ```
   /setprivacy - è®¾ç½®ä¸ºDisabledï¼ˆå…è®¸botè¯»å–ç¾¤ç»„æ¶ˆæ¯ï¼‰
   /setjoingroups - è®¾ç½®ä¸ºEnableï¼ˆå…è®¸botåŠ å…¥ç¾¤ç»„ï¼‰
   /setcommands - å¯é€‰ï¼Œè®¾ç½®botå‘½ä»¤
   ```

### **æ­¥éª¤2: åˆ›å»ºå­˜å‚¨é¢‘é“**

1. **åˆ›å»ºé¢‘é“**:
   - åœ¨Telegramä¸­åˆ›å»ºä¸€ä¸ªæ–°é¢‘é“
   - è®¾ç½®ä¸ºç§æœ‰é¢‘é“ï¼ˆæ¨èï¼‰
   - è®°å½•é¢‘é“åç§°

2. **æ·»åŠ Botä¸ºç®¡ç†å‘˜**:
   - è¿›å…¥é¢‘é“è®¾ç½® â†’ ç®¡ç†å‘˜
   - æ·»åŠ æ‚¨çš„botä¸ºç®¡ç†å‘˜
   - ç»™äºˆä»¥ä¸‹æƒé™ï¼š
     - âœ… å‘é€æ¶ˆæ¯
     - âœ… å‘é€åª’ä½“
     - âœ… å‘é€æ–‡ä»¶
     - âœ… åˆ é™¤æ¶ˆæ¯ï¼ˆå¯é€‰ï¼‰

3. **è·å–é¢‘é“ID**:
   - æ–¹æ³•1ï¼šè½¬å‘é¢‘é“æ¶ˆæ¯ç»™ `@userinfobot`
   - æ–¹æ³•2ï¼šä½¿ç”¨ `@getidsbot`
   - é¢‘é“IDæ ¼å¼ï¼š`-1001234567890`ï¼ˆè´Ÿæ•°ï¼‰

### **æ­¥éª¤3: é…ç½®ç¯å¢ƒå˜é‡**

#### **åœ¨Cloudflare Pagesä¸­é…ç½®**:

1. ç™»å½•Cloudflare Dashboard
2. è¿›å…¥Pagesé¡¹ç›®è®¾ç½®
3. æ‰¾åˆ°"Environment variables"éƒ¨åˆ†
4. æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

```bash
# Telegram Boté…ç½®
TG_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TG_CHAT_ID=-1001234567890

# å¯é€‰é…ç½®
R2PublicUrl=https://your-r2-domain.com
AllowRandom=false
disable_telemetry=false
```

#### **åœ¨wrangler.tomlä¸­é…ç½®**:

```toml
[env.production.vars]
TG_BOT_TOKEN = "123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
TG_CHAT_ID = "-1001234567890"

[env.preview.vars]
TG_BOT_TOKEN = "123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
TG_CHAT_ID = "-1001234567890"
```

### **æ­¥éª¤4: é…ç½®KVå‘½åç©ºé—´**

1. **åˆ›å»ºKVå‘½åç©ºé—´**:
   ```bash
   npx wrangler kv:namespace create "img_url"
   npx wrangler kv:namespace create "img_url" --preview
   ```

2. **æ›´æ–°wrangler.toml**:
   ```toml
   [[kv_namespaces]]
   binding = "img_url"
   id = "your-kv-namespace-id"
   preview_id = "your-preview-kv-namespace-id"
   ```

## ğŸ§ª æµ‹è¯•é…ç½®

### **è¿è¡Œé›†æˆæµ‹è¯•**:

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡å¹¶è¿è¡Œæµ‹è¯•
TEST_DOMAIN=your-domain.pages.dev \
TG_BOT_TOKEN=your-bot-token \
TG_CHAT_ID=your-chat-id \
node telegram-integration-test.js
```

### **é¢„æœŸæµ‹è¯•ç»“æœ**:

```
ğŸš€ å¼€å§‹Telegramé›†æˆæµ‹è¯•: https://your-domain.pages.dev
ğŸ¤– Bot Token: å·²é…ç½®
ğŸ’¬ Chat ID: å·²é…ç½®

==================================================
ğŸ§ª Telegram Botè¿æ¥
==================================================
âœ… Telegram Botè¿æ¥æˆåŠŸ
ğŸ“Š Botä¿¡æ¯: @your_bot (Your Bot Name)

==================================================
ğŸ§ª TelegramèŠå¤©è®¿é—®
==================================================
âœ… TelegramèŠå¤©è®¿é—®æˆåŠŸ
ğŸ“Š èŠå¤©ä¿¡æ¯: Your Channel (channel)

==================================================
ğŸ§ª ä¸Šä¼ é…ç½®æ£€æŸ¥
==================================================
âœ… ä¸Šä¼ é…ç½®è·å–æˆåŠŸ
ğŸ“Š Telegramæ¸ é“æ•°é‡: 1
   æ¸ é“1: Telegram_env (å¯ç”¨)

==================================================
ğŸ§ª æ–‡ä»¶åˆ—è¡¨API
==================================================
âœ… æ–‡ä»¶åˆ—è¡¨APIå“åº”æˆåŠŸ
ğŸ“Š Telegramå­˜å‚¨çš„æ–‡ä»¶: 0

==================================================
ğŸ§ª å›¾ç‰‡ä¸Šä¼ æµ‹è¯•
==================================================
âœ… å›¾ç‰‡ä¸Šä¼ æˆåŠŸ

ğŸ“Š Telegramé›†æˆæµ‹è¯•æŠ¥å‘Š
============================================================
æ€»æµ‹è¯•æ•°: 5
æˆåŠŸ: 5
å¤±è´¥: 0
æˆåŠŸç‡: 100%
```

## ğŸ”§ æ•…éšœæ’é™¤

### **å¸¸è§é—®é¢˜**

#### **1. Bot Tokenæ— æ•ˆ**
```
âŒ Telegram Botè¿æ¥å¤±è´¥: Unauthorized
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥tokenæ˜¯å¦æ­£ç¡®å¤åˆ¶
- ç¡®è®¤tokenæ²¡æœ‰è¿‡æœŸ
- é‡æ–°ä»BotFatherè·å–token

#### **2. èŠå¤©IDæ— æ•ˆ**
```
âŒ TelegramèŠå¤©è®¿é—®å¤±è´¥: Chat not found
```
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤é¢‘é“IDæ ¼å¼æ­£ç¡®ï¼ˆè´Ÿæ•°ï¼‰
- æ£€æŸ¥botæ˜¯å¦å·²æ·»åŠ åˆ°é¢‘é“
- ç¡®è®¤botæœ‰ç®¡ç†å‘˜æƒé™

#### **3. æƒé™ä¸è¶³**
```
âŒ å›¾ç‰‡ä¸Šä¼ å¤±è´¥: Forbidden: bot is not a member of the channel
```
**è§£å†³æ–¹æ¡ˆ**:
- å°†botæ·»åŠ ä¸ºé¢‘é“ç®¡ç†å‘˜
- ç»™äºˆbotå‘é€æ¶ˆæ¯å’Œåª’ä½“çš„æƒé™

#### **4. æ–‡ä»¶å¤§å°é™åˆ¶**
```
âŒ å›¾ç‰‡ä¸Šä¼ å¤±è´¥: Request Entity Too Large
```
**è§£å†³æ–¹æ¡ˆ**:
- Telegram Bot APIé™åˆ¶å•æ–‡ä»¶50MB
- å¤§æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ†ç‰‡ä¸Šä¼ 
- æ£€æŸ¥ç½‘ç»œè¿æ¥ç¨³å®šæ€§

### **è°ƒè¯•å·¥å…·**

#### **æ£€æŸ¥BotçŠ¶æ€**:
```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getMe"
```

#### **æ£€æŸ¥é¢‘é“ä¿¡æ¯**:
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getChat" \
     -H "Content-Type: application/json" \
     -d '{"chat_id": "<YOUR_CHAT_ID>"}'
```

#### **å‘é€æµ‹è¯•æ¶ˆæ¯**:
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/sendMessage" \
     -H "Content-Type: application/json" \
     -d '{"chat_id": "<YOUR_CHAT_ID>", "text": "Test message"}'
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### **åœ¨Webç•Œé¢ä¸­ç›‘æ§**:

1. è®¿é—®æ‚¨çš„ImgBedç½‘ç«™
2. å¦‚æœå‡ºç°é”™è¯¯ï¼Œç‚¹å‡»"ç½‘ç»œè¯Šæ–­"
3. æŸ¥çœ‹Telegramé›†æˆçŠ¶æ€
4. ä½¿ç”¨"æµ‹è¯•ä¸Šä¼ "åŠŸèƒ½éªŒè¯

### **æ—¥å¿—ç›‘æ§**:

- åœ¨Cloudflare Dashboardä¸­æŸ¥çœ‹Functionsæ—¥å¿—
- å…³æ³¨Telegram APIè°ƒç”¨çš„é”™è¯¯ä¿¡æ¯
- ç›‘æ§KVå­˜å‚¨çš„ä½¿ç”¨æƒ…å†µ

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¿æŠ¤Bot Token**:
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç token
   - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
   - å®šæœŸè½®æ¢token

2. **é¢‘é“å®‰å…¨**:
   - ä½¿ç”¨ç§æœ‰é¢‘é“å­˜å‚¨å›¾ç‰‡
   - é™åˆ¶é¢‘é“æˆå‘˜æ•°é‡
   - å®šæœŸæ£€æŸ¥é¢‘é“æƒé™

3. **è®¿é—®æ§åˆ¶**:
   - é…ç½®é€‚å½“çš„CORSç­–ç•¥
   - å®æ–½ä¸Šä¼ é¢‘ç‡é™åˆ¶
   - å¯ç”¨å†…å®¹å®¡æ ¸ï¼ˆå¦‚æœéœ€è¦ï¼‰

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **è¿è¡Œè¯Šæ–­æµ‹è¯•**:
   ```bash
   node telegram-integration-test.js
   ```

2. **æ£€æŸ¥æ—¥å¿—**:
   - Cloudflare Functionsæ—¥å¿—
   - æµè§ˆå™¨å¼€å‘è€…å·¥å…·Console
   - Networkè¯·æ±‚è¯¦æƒ…

3. **æä¾›ä¿¡æ¯**:
   - æµ‹è¯•è„šæœ¬è¾“å‡º
   - é”™è¯¯æ¶ˆæ¯æˆªå›¾
   - é…ç½®ä¿¡æ¯ï¼ˆéšè—æ•æ„Ÿæ•°æ®ï¼‰

---

**é…ç½®å®Œæˆåï¼Œæ‚¨çš„CloudFlare ImgBedå°±å¯ä»¥ä½¿ç”¨Telegramä½œä¸ºå›¾ç‰‡å­˜å‚¨åç«¯äº†ï¼** ğŸ‰
